<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Purim Pictionary</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--primary:#7C3AED;--primary-light:#A78BFA;--primary-dark:#5B21B6;--accent:#F59E0B;--accent-light:#FCD34D;--success:#10B981;--danger:#EF4444;--bg:#0F0A1A;--bg-card:#1A1230;--bg-input:#241B3A;--text:#F3F0FF;--text-muted:#9CA3AF;--border:#3B2D5E;--correct-green:#10B981;--close-yellow:#FBBF24}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse at 20% 50%,rgba(124,58,237,0.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(245,158,11,0.1) 0%,transparent 50%),radial-gradient(ellipse at 50% 80%,rgba(16,185,129,0.08) 0%,transparent 50%);pointer-events:none;z-index:0}h1,h2,h3{font-family:'Fredoka One',cursive}.screen{display:none;position:relative;z-index:1}.screen.active{display:flex}#welcome-screen{flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:2rem;gap:1.5rem;text-align:center}.logo{font-size:3.5rem;font-family:'Fredoka One',cursive;background:linear-gradient(135deg,var(--accent),var(--primary-light),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:none;filter:drop-shadow(0 4px 20px rgba(124,58,237,0.3))}.logo-emoji{font-size:4rem;display:block;margin-bottom:0.5rem}.subtitle{color:var(--text-muted);font-size:1.1rem;margin-top:-0.5rem}.card{background:var(--bg-card);border:1px solid var(--border);border-radius:1rem;padding:2rem;width:100%;max-width:420px}.card h2{margin-bottom:1.25rem;font-size:1.3rem;color:var(--accent)}.form-group{margin-bottom:1rem}.form-group label{display:block;margin-bottom:0.4rem;font-weight:600;font-size:0.9rem;color:var(--text-muted)}input,select{width:100%;padding:0.75rem 1rem;background:var(--bg-input);border:1.5px solid var(--border);border-radius:0.6rem;color:var(--text);font-size:1rem;font-family:inherit;transition:border-color 0.2s}input:focus,select:focus{outline:none;border-color:var(--primary)}input::placeholder{color:#6B5B8D}.btn{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.75rem 1.5rem;border:none;border-radius:0.6rem;font-family:'Nunito',sans-serif;font-weight:700;font-size:1rem;cursor:pointer;transition:all 0.2s;width:100%}.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white}.btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(124,58,237,0.4)}.btn-accent{background:linear-gradient(135deg,var(--accent),#D97706);color:#1A1230}.btn-accent:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(245,158,11,0.4)}.btn-success{background:linear-gradient(135deg,var(--success),#059669);color:white}.btn-danger{background:linear-gradient(135deg,var(--danger),#DC2626);color:white}.btn-outline{background:transparent;border:2px solid var(--border);color:var(--text)}.btn-outline:hover{border-color:var(--primary)}.btn-small{padding:0.5rem 1rem;font-size:0.85rem;width:auto}.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none!important}.divider{display:flex;align-items:center;gap:1rem;margin:1rem 0;color:var(--text-muted);font-size:0.85rem}.divider::before,.divider::after{content:'';flex:1;border-top:1px solid var(--border)}#lobby-screen{flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:2rem;gap:1.5rem}.room-code-display{font-family:'Fredoka One',cursive;font-size:3rem;letter-spacing:0.4rem;color:var(--accent);background:var(--bg-card);padding:0.5rem 2rem;border-radius:1rem;border:2px dashed var(--accent);cursor:pointer;transition:all 0.2s}.room-code-display:hover{background:rgba(245,158,11,0.1)}.player-list{display:flex;flex-wrap:wrap;gap:0.75rem;justify-content:center}.player-chip{background:var(--bg-input);padding:0.5rem 1rem;border-radius:2rem;font-weight:600;display:flex;align-items:center;gap:0.4rem;border:1.5px solid var(--border)}.player-chip.host{border-color:var(--accent)}.lobby-settings{display:flex;gap:1rem;align-items:center;flex-wrap:wrap;justify-content:center}.lobby-settings .form-group{margin:0;min-width:120px}.lobby-settings input,.lobby-settings select{padding:0.5rem 0.75rem;font-size:0.9rem}.championship-badge{background:linear-gradient(135deg,var(--accent),#F97316);color:#1A1230;padding:0.5rem 1.5rem;border-radius:2rem;font-weight:800;font-size:1.1rem;display:flex;align-items:center;gap:0.5rem;animation:pulse 2s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}#game-screen{flex-direction:column;height:100vh;overflow:hidden}.game-header{display:flex;align-items:center;justify-content:space-between;padding:0.75rem 1.5rem;background:var(--bg-card);border-bottom:1px solid var(--border);flex-wrap:wrap;gap:0.5rem}.round-info{font-weight:700;font-size:0.95rem;color:var(--text-muted)}.word-hint{font-family:'Fredoka One',cursive;font-size:1.6rem;letter-spacing:0.3rem;color:var(--accent);text-align:center;flex:1}.timer-display{font-family:'Fredoka One',cursive;font-size:2rem;min-width:60px;text-align:center;transition:color 0.3s}.timer-display.urgent{color:var(--danger);animation:timerPulse 0.5s infinite}@keyframes timerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}.game-body{display:flex;flex:1;overflow:hidden;min-height:0}.scoreboard{width:200px;background:var(--bg-card);border-right:1px solid var(--border);overflow-y:auto;padding:0.75rem;flex-shrink:0}.scoreboard h3{font-size:0.85rem;color:var(--text-muted);margin-bottom:0.5rem;text-transform:uppercase;letter-spacing:0.1rem}.score-entry{display:flex;align-items:center;gap:0.5rem;padding:0.4rem 0.5rem;border-radius:0.4rem;margin-bottom:0.25rem;font-size:0.85rem;transition:background 0.2s}.score-entry.drawing{background:rgba(124,58,237,0.2);border:1px solid var(--primary)}.score-entry.guessed{background:rgba(16,185,129,0.15)}.score-rank{font-weight:800;color:var(--text-muted);min-width:18px}.score-entry:nth-child(2) .score-rank{color:var(--accent)}.score-name{flex:1;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.score-points{font-weight:800;color:var(--accent)}.drawing-indicator{font-size:0.7rem;display:block;color:var(--primary-light)}.canvas-area{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative;min-height:0}.drawing-tools{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 1rem;background:var(--bg-card);border-bottom:1px solid var(--border);flex-wrap:wrap}.color-swatch{width:28px;height:28px;border-radius:50%;border:2px solid transparent;cursor:pointer;transition:all 0.15s}.color-swatch:hover{transform:scale(1.15)}.color-swatch.active{border-color:white;box-shadow:0 0 8px rgba(255,255,255,0.4)}.brush-size{display:flex;align-items:center;gap:0.3rem;margin-left:0.5rem}.brush-size input[type="range"]{width:80px;accent-color:var(--primary);padding:0}.tool-btn{padding:0.4rem 0.8rem;background:var(--bg-input);border:1.5px solid var(--border);border-radius:0.4rem;color:var(--text);font-size:0.85rem;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit}.tool-btn:hover{border-color:var(--primary)}.tool-btn.active{background:var(--primary);border-color:var(--primary)}.canvas-wrapper{flex:1;display:flex;align-items:stretch;justify-content:stretch;background:white;position:relative;overflow:hidden;min-height:0}canvas#drawing-canvas{display:block;cursor:crosshair;touch-action:none;width:100%;height:100%}.overlay-message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;pointer-events:none;z-index:10}.overlay-message h2{font-size:2.5rem;color:var(--primary-dark);text-shadow:2px 2px 4px rgba(0,0,0,0.1)}.overlay-message p{font-size:1.2rem;color:#555;margin-top:0.5rem}.your-word-display{position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;padding:0.6rem 2rem;border-radius:2rem;font-weight:800;font-size:1.1rem;z-index:10;box-shadow:0 4px 20px rgba(124,58,237,0.4);display:none}.chat-area{width:280px;display:flex;flex-direction:column;background:var(--bg-card);border-left:1px solid var(--border);flex-shrink:0;min-height:0;overflow:hidden}.chat-header{padding:0.75rem 1rem;border-bottom:1px solid var(--border);font-weight:700;font-size:0.9rem;color:var(--text-muted)}.chat-messages{flex:1;overflow-y:auto;padding:0.5rem;min-height:0}.chat-msg{padding:0.3rem 0.6rem;margin-bottom:0.25rem;border-radius:0.3rem;font-size:0.85rem;word-wrap:break-word}.chat-msg .sender{font-weight:700;margin-right:0.3rem}.chat-msg.system{color:var(--text-muted);font-style:italic;font-size:0.8rem}.chat-msg.correct{background:rgba(16,185,129,0.15);color:var(--correct-green);font-weight:700}.chat-msg.close{background:rgba(251,191,36,0.1);color:var(--close-yellow)}.chat-input-area{display:flex;padding:0.5rem;gap:0.5rem;border-top:1px solid var(--border)}.chat-input-area input{flex:1;padding:0.6rem 0.8rem;font-size:0.9rem}.chat-input-area button{padding:0.6rem 1rem;background:var(--primary);border:none;border-radius:0.6rem;color:white;font-weight:700;cursor:pointer}#gameover-screen{flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:2rem;gap:1.5rem;text-align:center}.winner-announcement{font-size:2.5rem;font-family:'Fredoka One',cursive;color:var(--accent)}.winner-name{font-size:3.5rem;font-family:'Fredoka One',cursive;background:linear-gradient(135deg,var(--accent),#F97316,var(--accent-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.final-scores{width:100%;max-width:500px}.final-score-row{display:flex;align-items:center;padding:0.75rem 1rem;border-radius:0.5rem;margin-bottom:0.5rem;background:var(--bg-input);border:1px solid var(--border)}.final-score-row:first-child{background:rgba(245,158,11,0.15);border-color:var(--accent)}.final-rank{font-family:'Fredoka One',cursive;font-size:1.5rem;min-width:40px;color:var(--text-muted)}.final-score-row:first-child .final-rank{color:var(--accent)}.final-name{flex:1;font-weight:700;font-size:1.1rem;text-align:left}.final-points{font-family:'Fredoka One',cursive;font-size:1.3rem;color:var(--accent)}.gameover-actions{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center}.gameover-actions .btn{width:auto;min-width:180px}.turn-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,10,26,0.92);display:none;align-items:center;justify-content:center;z-index:100;text-align:center}.turn-overlay.active{display:flex}.turn-overlay-content h2{font-size:2rem;color:var(--text);margin-bottom:0.5rem}.turn-overlay-content .reveal-word{font-size:2.5rem;color:var(--accent);font-family:'Fredoka One',cursive}.points-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Fredoka One',cursive;font-size:3rem;color:var(--correct-green);pointer-events:none;z-index:200;animation:pointsFloat 1.5s ease-out forwards;display:none}@keyframes pointsFloat{0%{opacity:1;transform:translate(-50%,-50%) scale(0.5)}30%{opacity:1;transform:translate(-50%,-70%) scale(1.2)}100%{opacity:0;transform:translate(-50%,-120%) scale(0.8)}}@media(max-width:900px){.scoreboard{width:150px}.chat-area{width:220px}}@media(max-width:700px){.game-body{flex-direction:column}.scoreboard{width:100%;height:auto;max-height:100px;border-right:none;border-bottom:1px solid var(--border);flex-direction:row;display:flex;overflow-x:auto}.scoreboard h3{display:none}.chat-area{width:100%;height:180px;border-left:none;border-top:1px solid var(--border)}}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.toast{position:fixed;top:1rem;left:50%;transform:translateX(-50%) translateY(-100px);background:var(--bg-card);border:1px solid var(--border);padding:0.75rem 1.5rem;border-radius:0.6rem;font-weight:600;z-index:300;transition:transform 0.3s ease;box-shadow:0 8px 30px rgba(0,0,0,0.3)}.toast.show{transform:translateX(-50%) translateY(0)}.toast.error{border-color:var(--danger);color:var(--danger)}.toast.success{border-color:var(--success);color:var(--success)}
</style>
</head>
<body>
<div class="toast" id="toast"></div>
<div class="points-popup" id="points-popup"></div>
<div class="turn-overlay" id="turn-overlay"><div class="turn-overlay-content"><h2 id="overlay-title"></h2><div class="reveal-word" id="overlay-word"></div></div></div>

<div class="screen active" id="welcome-screen">
<div class="logo-emoji">üé≠</div>
<h1 class="logo">Purim Pictionary</h1>
<p class="subtitle">Draw, Guess & Celebrate!</p>
<div class="card">
<h2>Join a Game</h2>
<div class="form-group"><label>Your Name</label><input type="text" id="player-name" placeholder="Enter your name..." maxlength="20" autocomplete="off"></div>
<div class="form-group"><label>Room Code</label><input type="text" id="room-code-input" placeholder="Enter 4-letter code" maxlength="4" style="text-transform:uppercase;letter-spacing:0.3rem;font-weight:700;" autocomplete="off"></div>
<button class="btn btn-primary" id="join-btn" style="margin-bottom:0.5rem;">Join Room</button>
<button class="btn btn-outline btn-small" id="spectate-btn" style="width:100%;">Join as Spectator</button>
<div class="divider">or</div>
<button class="btn btn-accent" id="create-btn">Create New Room</button>
</div>
</div>

<div class="screen" id="lobby-screen">
<h1 class="logo" style="font-size:2rem;">üé≠ Purim Pictionary</h1>
<div id="championship-badge-container" style="display:none;"><div class="championship-badge">üèÜ CHAMPIONSHIP ROUND üèÜ</div></div>
<div><p style="color:var(--text-muted);margin-bottom:0.5rem;">Share this code with your group:</p><div class="room-code-display" id="room-code-display" title="Click to copy">----</div><p style="color:var(--text-muted);font-size:0.8rem;margin-top:0.3rem;">Click to copy</p></div>
<div class="card" style="max-width:600px;"><h2>Players (<span id="player-count">0</span>)</h2><div class="player-list" id="lobby-players"></div></div>
<div class="lobby-settings" id="lobby-settings">
<div class="form-group"><label>Rounds</label><input type="number" id="setting-rounds" value="10" min="3" max="30" style="width:80px;"></div>
<div class="form-group"><label>Time (sec)</label><input type="number" id="setting-time" value="40" min="15" max="90" style="width:80px;"></div>
<div class="form-group" style="display:flex;align-items:flex-end;"><label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;"><input type="checkbox" id="setting-championship" style="width:auto;"> Championship Mode üèÜ</label></div>
</div>
<button class="btn btn-success" id="start-game-btn" style="max-width:300px;display:none;">Start Game!</button>
<p id="waiting-msg" style="color:var(--text-muted);">Waiting for host to start...</p>
</div>

<div class="screen" id="game-screen">
<div class="game-header">
<div class="round-info" id="round-info">Round 1/10</div>
<div class="word-hint" id="word-hint">_ _ _ _ _</div>
<div class="timer-display" id="timer-display">40</div>
</div>
<div class="game-body">
<div class="scoreboard" id="scoreboard"><h3>Scoreboard</h3></div>
<div class="canvas-area">
<div class="drawing-tools" id="drawing-tools" style="display:none;"></div>
<div class="canvas-wrapper" id="canvas-wrapper">
<canvas id="drawing-canvas"></canvas>
<div class="overlay-message" id="canvas-overlay" style="display:none;"><h2>Get Ready!</h2><p>Game is starting...</p></div>
<div class="your-word-display" id="your-word-display"></div>
</div>
</div>
<div class="chat-area">
<div class="chat-header">Guesses</div>
<div class="chat-messages" id="chat-messages"></div>
<div class="chat-input-area"><input type="text" id="guess-input" placeholder="Type your guess..." maxlength="50" autocomplete="off"><button id="guess-btn">Send</button></div>
</div>
</div>
</div>

<div class="screen" id="gameover-screen">
<div class="logo-emoji">üèÜ</div>
<div class="winner-announcement" id="winner-title">Winner!</div>
<div class="winner-name" id="winner-name">---</div>
<div class="final-scores card" id="final-scores" style="max-width:500px;"></div>
<div class="gameover-actions">
<button class="btn btn-primary" id="play-again-btn">Play Again</button>
<button class="btn btn-outline" id="back-home-btn">Back to Home</button>
</div>
</div>

<div id="spectator-banner" style="display:none;position:fixed;top:0;left:0;right:0;background:rgba(124,58,237,0.9);color:white;text-align:center;padding:0.4rem;font-weight:700;z-index:50;font-size:0.85rem;">üëÅ SPECTATING</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();let myId=null,myName='',roomCode='',isHost=false,isDrawer=false,isSpectator=false,currentDrawerId=null,gameState='welcome',canvasCtx=null,drawing=false,lastX=0,lastY=0,currentColor='#000000',currentBrushSize=4,isEraser=false;
const COLORS=['#000000','#FFFFFF','#808080','#EF4444','#F97316','#FBBF24','#22C55E','#06B6D4','#3B82F6','#8B5CF6','#EC4899','#92400E'];
const $=id=>document.getElementById(id);
function showScreen(screenId){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));$(screenId).classList.add('active')}
function showToast(msg,type='error'){const toast=$('toast');toast.textContent=msg;toast.className=`toast ${type} show`;setTimeout(()=>toast.classList.remove('show'),3000)}
function showPointsPopup(points){const popup=$('points-popup');popup.textContent=`+${points}`;popup.style.display='block';popup.style.animation='none';popup.offsetHeight;popup.style.animation='pointsFloat 1.5s ease-out forwards';setTimeout(()=>popup.style.display='none',1500)}
function showTurnOverlay(title,word,duration=3000){$('overlay-title').textContent=title;$('overlay-word').textContent=word||'';$('turn-overlay').classList.add('active');setTimeout(()=>$('turn-overlay').classList.remove('active'),duration)}
function setupCanvas(){const canvas=$('drawing-canvas'),wrapper=$('canvas-wrapper'),rect=wrapper.getBoundingClientRect();const w=Math.floor(rect.width),h=Math.floor(rect.height);canvas.width=w;canvas.height=h;canvasCtx=canvas.getContext('2d');canvasCtx.lineCap='round';canvasCtx.lineJoin='round';canvasCtx.fillStyle='white';canvasCtx.fillRect(0,0,w,h)}
window.addEventListener('resize',()=>{if(gameState==='playing'){const canvas=$('drawing-canvas'),wrapper=$('canvas-wrapper'),rect=wrapper.getBoundingClientRect();const imgData=canvasCtx.getImageData(0,0,canvas.width,canvas.height);const w=Math.floor(rect.width),h=Math.floor(rect.height);canvas.width=w;canvas.height=h;canvasCtx=canvas.getContext('2d');canvasCtx.lineCap='round';canvasCtx.lineJoin='round';canvasCtx.fillStyle='white';canvasCtx.fillRect(0,0,w,h);canvasCtx.putImageData(imgData,0,0)}})
function clearCanvas(){if(!canvasCtx)return;const canvas=$('drawing-canvas');canvasCtx.fillStyle='white';canvasCtx.fillRect(0,0,canvas.width,canvas.height)}
function getCanvasCoords(e){const canvas=$('drawing-canvas'),rect=canvas.getBoundingClientRect(),scaleX=canvas.width/rect.width,scaleY=canvas.height/rect.height;let x,y;if(e.touches){x=(e.touches[0].clientX-rect.left)*scaleX;y=(e.touches[0].clientY-rect.top)*scaleY}else{x=(e.clientX-rect.left)*scaleX;y=(e.clientY-rect.top)*scaleY}return{x,y}}
function drawLine(x1,y1,x2,y2,color,size){if(!canvasCtx)return;canvasCtx.strokeStyle=color;canvasCtx.lineWidth=size;canvasCtx.beginPath();canvasCtx.moveTo(x1,y1);canvasCtx.lineTo(x2,y2);canvasCtx.stroke()}
function drawDot(x,y,color,size){if(!canvasCtx)return;canvasCtx.fillStyle=color;canvasCtx.beginPath();canvasCtx.arc(x,y,size/2,0,Math.PI*2);canvasCtx.fill()}
function setupDrawingTools(){const toolsDiv=$('drawing-tools');toolsDiv.innerHTML='';COLORS.forEach(color=>{const swatch=document.createElement('div');swatch.className=`color-swatch ${color===currentColor?'active':''}`;swatch.style.background=color;if(color==='#FFFFFF')swatch.style.border='2px solid #ccc';swatch.onclick=()=>{isEraser=false;currentColor=color;document.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('active'));swatch.classList.add('active');document.querySelector('.tool-btn.eraser')?.classList.remove('active')};toolsDiv.appendChild(swatch)});const sep=document.createElement('div');sep.style.cssText='width:1px;height:28px;background:var(--border);margin:0 0.3rem;';toolsDiv.appendChild(sep);const brushDiv=document.createElement('div');brushDiv.className='brush-size';brushDiv.innerHTML=`<span style="font-size:0.75rem;">üñå</span><input type="range" min="2" max="30" value="${currentBrushSize}" id="brush-slider">`;toolsDiv.appendChild(brushDiv);const eraserBtn=document.createElement('button');eraserBtn.className='tool-btn eraser';eraserBtn.textContent='üßπ Eraser';eraserBtn.onclick=()=>{isEraser=!isEraser;eraserBtn.classList.toggle('active',isEraser);if(isEraser)document.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('active'))};toolsDiv.appendChild(eraserBtn);const fillBtn=document.createElement('button');fillBtn.className='tool-btn';fillBtn.textContent='ü™£ Fill';fillBtn.onclick=()=>{const canvas=$('drawing-canvas');canvasCtx.fillStyle=currentColor;canvasCtx.fillRect(0,0,canvas.width,canvas.height);socket.emit('clear_canvas');socket.emit('draw',{type:'fill',color:currentColor})};toolsDiv.appendChild(fillBtn);const clearBtn=document.createElement('button');clearBtn.className='tool-btn';clearBtn.textContent='üóë Clear';clearBtn.onclick=()=>{clearCanvas();socket.emit('clear_canvas')};toolsDiv.appendChild(clearBtn);const skipBtn=document.createElement('button');skipBtn.className='tool-btn';skipBtn.style.cssText='margin-left:auto;color:var(--danger);';skipBtn.textContent='‚è≠ Skip';skipBtn.onclick=()=>socket.emit('skip_word');toolsDiv.appendChild(skipBtn);setTimeout(()=>{const slider=$('brush-slider');if(slider)slider.oninput=(e)=>currentBrushSize=parseInt(e.target.value)},0)}
function initCanvasEvents(){const canvas=$('drawing-canvas');function startDraw(e){if(!isDrawer)return;e.preventDefault();drawing=true;const{x,y}=getCanvasCoords(e);lastX=x;lastY=y;const color=isEraser?'#FFFFFF':currentColor,size=isEraser?currentBrushSize*3:currentBrushSize;drawDot(x,y,color,size);socket.emit('draw',{type:'dot',x,y,color,size})}function moveDraw(e){if(!isDrawer||!drawing)return;e.preventDefault();const{x,y}=getCanvasCoords(e);const color=isEraser?'#FFFFFF':currentColor,size=isEraser?currentBrushSize*3:currentBrushSize;drawLine(lastX,lastY,x,y,color,size);socket.emit('draw',{type:'line',x1:lastX,y1:lastY,x2:x,y2:y,color,size});lastX=x;lastY=y}function endDraw(){drawing=false}canvas.addEventListener('mousedown',startDraw);canvas.addEventListener('mousemove',moveDraw);canvas.addEventListener('mouseup',endDraw);canvas.addEventListener('mouseleave',endDraw);canvas.addEventListener('touchstart',startDraw,{passive:false});canvas.addEventListener('touchmove',moveDraw,{passive:false});canvas.addEventListener('touchend',endDraw)}
function renderScoreboard(players){const sb=$('scoreboard');sb.innerHTML='<h3>Scoreboard</h3>';players.forEach((p,i)=>{const isDrawing=p.id===currentDrawerId,hasGuessed=p.guessed;const div=document.createElement('div');div.className=`score-entry ${isDrawing?'drawing':''} ${hasGuessed?'guessed':''}`;div.innerHTML=`<span class="score-rank">#${i+1}</span><span class="score-name">${p.name} ${p.id===myId?'(you)':''} ${isDrawing?'<span class="drawing-indicator">üé® drawing</span>':''}</span><span class="score-points">${p.score}</span>`;sb.appendChild(div)})}
function addChatMessage(html,className=''){const div=document.createElement('div');div.className=`chat-msg ${className}`;div.innerHTML=html;$('chat-messages').appendChild(div);$('chat-messages').scrollTop=$('chat-messages').scrollHeight}
$('join-btn').onclick=()=>{const name=$('player-name').value.trim(),code=$('room-code-input').value.trim().toUpperCase();if(!name){showToast('Please enter your name');return}if(!code||code.length<4){showToast('Please enter a valid room code');return}myName=name;socket.emit('join_room',{roomCode:code,playerName:name})};
$('spectate-btn').onclick=()=>{const name=$('player-name').value.trim()||'Spectator',code=$('room-code-input').value.trim().toUpperCase();if(!code||code.length<4){showToast('Please enter a room code to spectate');return}myName=name;isSpectator=true;socket.emit('join_room',{roomCode:code,playerName:name,asSpectator:true})};
$('create-btn').onclick=()=>{const name=$('player-name').value.trim();if(!name){showToast('Please enter your name');return}myName=name;isHost=true;socket.emit('create_room',{playerName:name,totalRounds:parseInt($('setting-rounds').value)||10,timePerTurn:parseInt($('setting-time').value)||40})};
$('player-name').addEventListener('keydown',(e)=>{if(e.key==='Enter'){const code=$('room-code-input').value.trim();if(code.length>=4)$('join-btn').click();else $('room-code-input').focus()}});
$('room-code-input').addEventListener('keydown',(e)=>{if(e.key==='Enter')$('join-btn').click()});
$('room-code-display').onclick=()=>{navigator.clipboard?.writeText(roomCode);showToast('Room code copied!','success')};
$('start-game-btn').onclick=()=>{socket.emit('start_game')};
$('guess-input').addEventListener('keydown',(e)=>{if(e.key==='Enter'){const msg=$('guess-input').value.trim();if(!msg)return;socket.emit('guess',{message:msg});$('guess-input').value=''}});
$('guess-btn').onclick=()=>{const msg=$('guess-input').value.trim();if(!msg)return;socket.emit('guess',{message:msg});$('guess-input').value=''};
$('play-again-btn').onclick=()=>{window.location.reload()};
$('back-home-btn').onclick=()=>{window.location.reload()};
socket.on('connect',()=>{myId=socket.id});
socket.on('error_message',({message})=>{showToast(message)});
socket.on('room_created',({code,players,isChampionship})=>{roomCode=code;isHost=true;showScreen('lobby-screen');$('room-code-display').textContent=code;renderLobbyPlayers(players);$('start-game-btn').style.display='block';$('waiting-msg').style.display='none';$('lobby-settings').style.display='flex';if(isChampionship){$('championship-badge-container').style.display='block';$('setting-championship').checked=true}});
socket.on('room_joined',({code,players,isChampionship})=>{roomCode=code;showScreen('lobby-screen');$('room-code-display').textContent=code;renderLobbyPlayers(players);if(!isHost){$('start-game-btn').style.display='none';$('waiting-msg').style.display='block';$('lobby-settings').style.display='none'}if(isChampionship){$('championship-badge-container').style.display='block'}});
socket.on('joined_as_spectator',({code,players,state,isChampionship})=>{roomCode=code;isSpectator=true;$('spectator-banner').style.display='block';if(state==='lobby'){showScreen('lobby-screen');$('room-code-display').textContent=code;renderLobbyPlayers(players);$('start-game-btn').style.display='none';$('waiting-msg').textContent='You are spectating this game';$('lobby-settings').style.display='none'}else if(state==='playing'){showScreen('game-screen');setupCanvas();initCanvasEvents();renderScoreboard(players)}});
socket.on('player_joined',({name,players})=>{renderLobbyPlayers(players);showToast(`${name} joined!`,'success')});
socket.on('player_left',({name,players})=>{renderLobbyPlayers(players);if(gameState==='playing')renderScoreboard(players);addChatMessage(`${name} left the game`,'system')});
socket.on('new_host',({hostId,players})=>{if(hostId===myId){isHost=true;showToast('You are now the host!','success');if(gameState==='lobby'){$('start-game-btn').style.display='block';$('waiting-msg').style.display='none'}}});
socket.on('game_started',({players,totalRounds})=>{gameState='playing';showScreen('game-screen');setupCanvas();initCanvasEvents();renderScoreboard(players);$('chat-messages').innerHTML='';addChatMessage('üé≠ Game started! Get ready...','system')});
socket.on('turn_start',({drawer,hint,roundNumber,totalRounds,timeRemaining,players})=>{currentDrawerId=drawer.id;isDrawer=drawer.id===myId;clearCanvas();$('round-info').textContent=`Round ${roundNumber}/${totalRounds}`;$('word-hint').textContent=hint;$('timer-display').textContent=timeRemaining;$('timer-display').classList.remove('urgent');renderScoreboard(players);addChatMessage(`üé® <b>${drawer.name}</b> is drawing!`,'system');$('drawing-tools').style.display=isDrawer?'flex':'none';$('your-word-display').style.display='none';$('guess-input').disabled=isDrawer||isSpectator;$('guess-input').placeholder=isDrawer?'You are drawing!':(isSpectator?'Spectating...':'Type your guess...');if(isDrawer){setupDrawingTools();$('drawing-canvas').style.cursor='crosshair'}else{$('drawing-canvas').style.cursor='default'}});
socket.on('your_word',({word})=>{$('your-word-display').textContent=`Draw: ${word}`;$('your-word-display').style.display='block';$('word-hint').textContent=word});
socket.on('hint_update',({hint})=>{if(!isDrawer)$('word-hint').textContent=hint});
socket.on('timer_update',({timeRemaining})=>{$('timer-display').textContent=timeRemaining;if(timeRemaining<=10)$('timer-display').classList.add('urgent')});
socket.on('draw',(data)=>{if(data.type==='line')drawLine(data.x1,data.y1,data.x2,data.y2,data.color,data.size);else if(data.type==='dot')drawDot(data.x,data.y,data.color,data.size);else if(data.type==='fill'&&canvasCtx){const canvas=$('drawing-canvas');canvasCtx.fillStyle=data.color;canvasCtx.fillRect(0,0,canvas.width,canvas.height)}});
socket.on('clear_canvas',()=>{clearCanvas()});
socket.on('chat_message',({playerId,playerName,message,isClose})=>{const cls=isClose?'close':'';addChatMessage(`<span class="sender">${playerName}:</span> ${message}`,cls)});
socket.on('correct_guess',({playerId,playerName,points,drawerPoints,players})=>{addChatMessage(`üéâ <b>${playerName}</b> guessed correctly! (+${points} pts)`,'correct');renderScoreboard(players);if(playerId===myId){showPointsPopup(points);$('guess-input').disabled=true;$('guess-input').placeholder='You guessed it!'}if(isDrawer)showPointsPopup(drawerPoints)});
socket.on('you_guessed_correctly',({word})=>{$('word-hint').textContent=word});
socket.on('turn_end',({word,wasGuessed,players,roundNumber,totalRounds})=>{isDrawer=false;currentDrawerId=null;$('drawing-tools').style.display='none';$('your-word-display').style.display='none';$('guess-input').disabled=true;const msg=wasGuessed?`The word was: ${word}`:`‚è∞ Time's up! The word was: ${word}`;addChatMessage(msg,'system');showTurnOverlay(wasGuessed?'The word was':"Time's up! The word was",word,3000);renderScoreboard(players)});
socket.on('game_over',({players,winner,isChampionship})=>{gameState='finished';showScreen('gameover-screen');$('winner-title').textContent=isChampionship?'üèÜ CHAMPION! üèÜ':'üéâ Winner!';$('winner-name').textContent=winner?winner.name:'Nobody';const scoresDiv=$('final-scores');scoresDiv.innerHTML='<h2 style="margin-bottom:1rem;">Final Scores</h2>';players.forEach((p,i)=>{const row=document.createElement('div');row.className='final-score-row';const medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';row.innerHTML=`<span class="final-rank">${medal||'#'+(i+1)}</span><span class="final-name">${p.name} ${p.id===myId?'(you)':''}</span><span class="final-points">${p.score}</span>`;scoresDiv.appendChild(row)})});
function renderLobbyPlayers(players){const container=$('lobby-players');container.innerHTML='';$('player-count').textContent=players.length;players.forEach(p=>{const chip=document.createElement('div');chip.className=`player-chip ${p.isHost?'host':''}`;chip.innerHTML=`${p.isHost?'üëë ':''}${p.name} ${p.id===myId?'(you)':''}`;container.appendChild(chip)})}
/* resize handled in setupCanvas */
$('player-name').focus();
const urlParams=new URLSearchParams(window.location.search);const urlRoom=urlParams.get('room');if(urlRoom)$('room-code-input').value=urlRoom.toUpperCase();
</script>
</body>
</html>
